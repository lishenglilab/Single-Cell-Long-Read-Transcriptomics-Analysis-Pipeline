nextflow.enable.dsl=2

/*
 * Re-run behavior
 * - With work/ preserved, Nextflow will skip completed processes when -resume or resume=true.
 */
resume = true
process.cache = 'deep'

params {
  // Study Description for biological interpretation
  study_description = """
This is a single-cell full-length transcriptome sequencing analysis comparing AD (atopic dermatitis) and Normal (normal skin cells) conditions. 
The study aims to identify differentially expressed transcripts and alternative splicing events in AD, 
exploring disease-associated isoform switching and its functional consequences.
Analysis was performed using IsoQuant for transcriptome assembly and SUPPA2 for alternative splicing analysis.
"""



  /*
   * Global output root
   */
  outdir = "/data/haowu/sc_long_v2/pipline_v2/demo/result"
  api_key = "sk-403bc4c7826a475e9646978562cb324a"
  species = 'Human'
  tissue = 'Skin'
  deepseek_model ='deepseek-reasoner'

  /*
   * Module (1): PREPROCESS
   */
  metadata     = "metadata.tsv"
  whitelist    = "assets/3M-february-2018.txt"
  expect_cells = 300
  threads      = 16
  nanofilt_q = 10

  /*
   * Module (2): ALIGN_QUANT
   */
  

  // Reference files (edit as needed)
  reference_fa  = "/data/reference/gtf/GRCh38.primary_assembly.genome.fa"
  genedb_gtf     = "/data/haowu/reference/Gencode_v48/gencode.v48.annotation.gtf"


  /*
   * Module (3): SC_PRELIM_ANALYSIS
   */
  // Single-cell analysis parameters
  min_cells = 10
  min_features = 200

  /*
   * Module (4): Alternative splicing + Dominant isoform
   * - id_map will be generated from IsoQuant OUT/OUT.transcript_models.gtf automatically
   */
  split_size = 100  // Number of cells per split file for SUPPA2
  ase_min_cell_prop = 0.01
  // Stage configuration for dominant isoform analysis
  sample_stage_mapping = [
    ["AD1", "AD"],
    ["AD2", "AD"],
    ["AD3", "AD"],
    ["N1", "Normal"],
    ["N2", "Normal"],
    ["N3", "Normal"]
  ]

   // Comparison configurations - specify which comparisons to perform
  // Format: [group1, group2, comparison_name]
  // comparisons = [
  //   ["AD", "Normal", "AD_vs_Normal"],
  //   ["KO", "Normal", "KO_vs_Normal"],
  //   ["AD", "KO", "AD_vs_KO"]
  // ]
  // Comparison configurations - specify which comparisons to perform
  // Format: [group1, group2, comparison_name]
  comparisons = [
    ["AD", "Normal", "AD_vs_Normal"]
  ]
  // Dominant Isoform Detection parameters
  dominant_min_cells = 10
  dominant_n_cores = 15
  dominant_logfc_threshold = 1.0
   // Isoform Switch Analysis parameters
  isoform_n_cores = 15
  isoform_dIF_cutoff = 0.1
  isoform_alpha = 0.05
  // External tool result files (optional - leave empty to skip analysis)
  cpc2_result_file = ""  // e.g., "/path/to/result_cpc.txt"
  pfam_result_file = ""  // e.g., "/path/to/pfam_results.txt"
  signalp_result_file = ""  // e.g., "/path/to/signalP_results_summary.signalp5"
  iupred2a_result_file = ""  // e.g., "/path/to/iupred2a_result.txt"

  /*
   * Module (5): Integrative Analysis 
   * - id_map will be generated from IsoQuant OUT/OUT.transcript_models.gtf automatically
   */
  integration_logfc_threshold = 1.5
  integration_pval_threshold = 0.05
  integration_min_pct = 0.01
  integration_n_cores = 10
  orf_resolution = 0.4
  orf_dims = "1:30"
}

conda.enabled  = true
conda.cacheDir = "${projectDir}/.conda"

/*
 * Conda environment policy:
 * - Default: sclong.yml for all processes
 * - Override: preprocess label uses preprocess.yml
 */
process {
  conda = "${projectDir}/envs/sclong.yml"

  withLabel: preprocess {
    conda = "${projectDir}/envs/preprocess.yml"
  }
  withLabel: alternativesplicing {
    conda = "${projectDir}/envs/alternativesplicing.yml"
  }
}
